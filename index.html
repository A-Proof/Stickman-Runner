<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stickman Runner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        background: #1a1a1a;
        font-family: Arial, sans-serif;
        color: white;
        overflow: hidden;
    }

    header, #menu, #gameOver, #levelComplete {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(0,0,0,0.85);
        text-align: center;
        z-index: 10;
    }

    h1 {
        font-size: 48px;
        margin-bottom: 20px;
        color: #5ee3ff;
        letter-spacing: 2px;
    }

    .btn {
        background: #5ee3ff;
        padding: 12px 26px;
        margin-top: 10px;
        font-size: 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: transform 0.1s;
        color: #000;
    }

    .btn:active {
        transform: scale(0.95);
    }

    #gameContainer {
        width: 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    canvas {
        background: #222;
        border: 4px solid #5ee3ff;
        border-radius: 12px;
    }

    /* Mobile touch buttons */
    .touch {
        position: absolute;
        bottom: 30px;
        background: rgba(255,255,255,0.1);
        padding: 25px;
        border-radius: 50%;
        border: 2px solid #5ee3ff;
        touch-action: none;
        user-select: none;
        font-size: 20px;
        font-weight: bold;
    }

    #leftBtn { left: 30px; }
    #rightBtn { left: 110px; }
    #jumpBtn { right: 30px; }

</style>
</head>

<body>

<!-- Menu Screen -->
<div id="menu">
    <h1>Stickman Runner</h1>
    <p>A Cool Platformer with Purpose</p>
    <button class="btn" onclick="startGame()">Start Game</button>
</div>

<!-- Level Complete -->
<div id="levelComplete" style="display:none;">
    <h1>Level Complete!</h1>
    <button class="btn" onclick="nextLevel()">Next Level</button>
</div>

<!-- Game Over -->
<div id="gameOver" style="display:none;">
    <h1>Game Over</h1>
    <button class="btn" onclick="restartLevel()">Try Again</button>
</div>

<div id="gameContainer">
    <canvas id="game" width="900" height="450"></canvas>
</div>

<!-- Mobile controls -->
<div id="leftBtn" class="touch">←</div>
<div id="rightBtn" class="touch">→</div>
<div id="jumpBtn" class="touch">⭡</div>

<script>
/* ----------------------- Audio ----------------------- */
const music = new Audio();
music.src = "data:audio/mp3;base64,/* short silent file to avoid hosting */";
music.loop = true;
music.volume = 0.3;

/* ----------------------- Canvas ----------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ----------------------- Game State ----------------------- */
let level = parseInt(localStorage.getItem("sr_level") || "1");
let player, enemies, platforms, coins;

function startGame() {
    document.getElementById("menu").style.display = "none";
    loadLevel(level);
    music.play();
}

function loadLevel(n) {
    document.getElementById("levelComplete").style.display = "none";
    document.getElementById("gameOver").style.display = "none";

    // Base player
    player = {
        x: 50,
        y: 350,
        w: 30,
        h: 50,
        vy: 0,
        jumping: false
    };

    // Level data
    const levelData = {
        1: {
            platforms: [
                {x:0,y:400,w:900,h:40},
                {x:200,y:330,w:120,h:20},
                {x:400,y:280,w:140,h:20},
                {x:650,y:330,w:140,h:20}
            ],
            coins: [
                {x:220,y:290},
                {x:430,y:240},
                {x:690,y:290}
            ],
            enemies: [
                {x:500,y:368,w:30,h:32,dir:1}
            ]
        },
        2: {
            platforms: [
                {x:0,y:400,w:900,h:40},
                {x:250,y:330,w:120,h:20},
                {x:420,y:260,w:140,h:20},
                {x:720,y:300,w:120,h:20},
                {x:820,y:240,w:60,h:20}
            ],
            coins: [
                {x:270,y:290},
                {x:450,y:220},
                {x:740,y:260},
                {x:840,y:200}
            ],
            enemies: [
                {x:300,y:368,w:30,h:32,dir:-1},
                {x:600,y:368,w:30,h:32,dir:1}
            ]
        }
    };

    const data = levelData[n];
    platforms = data.platforms;
    coins = data.coins;
    enemies = data.enemies;

    gameLoop();
}

function nextLevel() {
    level++;
    localStorage.setItem("sr_level", level);
    loadLevel(level);
}

function restartLevel() {
    loadLevel(level);
}

/* ----------------------- Controls ----------------------- */
let keys = {};

document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

/* Mobile Buttons */
const btn = id => document.getElementById(id);
btn("leftBtn").addEventListener("touchstart",()=>keys["ArrowLeft"]=true);
btn("leftBtn").addEventListener("touchend",()=>keys["ArrowLeft"]=false);
btn("rightBtn").addEventListener("touchstart",()=>keys["ArrowRight"]=true);
btn("rightBtn").addEventListener("touchend",()=>keys["ArrowRight"]=false);
btn("jumpBtn").addEventListener("touchstart",()=>keys["Space"]=true);
btn("jumpBtn").addEventListener("touchend",()=>keys["Space"]=false);

/* ----------------------- Game Loop ----------------------- */
const gravity = 0.6;

function update() {
    // Movement
    if (keys["ArrowRight"]) player.x += 4;
    if (keys["ArrowLeft"]) player.x -= 4;

    // Jump
    if ((keys["Space"] || keys["ArrowUp"]) && !player.jumping) {
        player.vy = -12;
        player.jumping = true;
    }

    // Gravity
    player.vy += gravity;
    player.y += player.vy;

    // Platforms
    platforms.forEach(p=>{
        if (
            player.x < p.x + p.w &&
            player.x + player.w > p.x &&
            player.y + player.h < p.y + p.h &&
            player.y + player.h + player.vy >= p.y
        ) {
            player.y = p.y - player.h;
            player.vy = 0;
            player.jumping = false;
        }
    });

    // Enemies
    enemies.forEach(e=>{
        e.x += e.dir * 2;
        if (e.x < 0 || e.x > canvas.width-30) e.dir *= -1;

        if (checkCollision(player,e)) {
            document.getElementById("gameOver").style.display = "flex";
        }
    });

    // Coins
    coins = coins.filter(c=>{
        if (Math.abs(player.x - c.x) < 25 && Math.abs(player.y - c.y) < 40) {
            return false;
        }
        return true;
    });

    // Win when all coins collected
    if (coins.length === 0) {
        document.getElementById("levelComplete").style.display = "flex";
    }

    // Fall off map
    if (player.y > canvas.height) {
        document.getElementById("gameOver").style.display = "flex";
    }
}

function checkCollision(a,b) {
    return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
    );
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Platforms
    ctx.fillStyle="#444";
    platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

    // Player
    ctx.fillStyle="white";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.beginPath();
    ctx.arc(player.x+15, player.y-10, 12, 0, Math.PI*2);
    ctx.fill();

    // Coins
    ctx.fillStyle="#ffe66d";
    coins.forEach(c=>{
        ctx.beginPath();
        ctx.arc(c.x,c.y,10,0,Math.PI*2);
        ctx.fill();
    });

    // Enemies
    ctx.fillStyle="#ff5757";
    enemies.forEach(e=>{
        ctx.fillRect(e.x, e.y, e.w, e.h);
    });
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}
</script>

</body>
</html>
